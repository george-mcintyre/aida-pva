<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AIDA-PVA: Writing an AIDA-PVA Service - Programmers Reference Manual</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="aida-pva-logo-small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AIDA-PVA<span id="projectnumber">&#160;2.0</span>
   </div>
   <div id="projectbrief">AIDA-PVA is the latest version of the AIDA framework.  Built on top of EPICS 7 it enables client applications to programmatically access and manage any device or database on the SLAC Network using simple channel names.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Writing an AIDA-PVA Service - Programmers Reference Manual </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md11"></a>
Overview</h1>
<p ><code>AIDA-PVA</code> provides a framework for <code>Channel Providers</code> to service requests for <code>Channels</code> that they support. A <code>Channel</code> is an EPICS term, co-opted by AIDA-PVA, to mean <em>any identifiable source of data in any <code>Channel Data Source</code> on the <code>SLAC Network</code></em>.</p>
<p >All AIDA-PVA Channels use a standard notation: </p><pre class="fragment">channel := part ':' second_part [ ':' other_part ... ]
</pre><p> a set of at least two parts separated by colons. <br  />
</p>
<p ><em>The framework has five main features.</em></p>
<ul>
<li><b>Routing</b> client <code>Channel Requests</code> using EPICS' <code>PVAccess</code>, through the <code>AIDA-PVA Service</code> to the registered <code>Channel Provider</code> endpoints.</li>
<li>Bi-directionally <b>Marshalling, Transporting, and Converting</b> arguments and data.</li>
<li>Raising, and <b>Propagating Exceptions</b> throughout the framework, back to clients, and on to logging services</li>
<li>Providing <b>AIDA-PVA utilities</b> that implement the boilerplate functions required to service channel requests</li>
<li>Providing access to <code>AIDASHR</code>, to allow <code>Channel Provider</code> code to leverage legacy <b>Channel Provider Modules</b> for accessing devices, databases and other services from <code>Channel Data Sources</code> on the <code>SLAC Network</code>.</li>
</ul>
<h1><a class="anchor" id="autotoc_md12"></a>
How it works</h1>
<ol type="1">
<li>When your <code>Channel Provider</code> starts up, the <code>AIDA-PVA</code> process that started it will read the <code>CHANNELS.YML</code> file that you've provided to determine which EPICS search requests it should respond to.</li>
<li>Subsequently, when clients send requests containing references to one of those <b>Channels</b>,</li>
<li>and EPICS seach request is propagated across the EPICS network</li>
<li>The <code>EPICS Forwarder</code> that is constantly listening for requests will forward it to all the AIDA-PVA processes running in VMS.</li>
<li>When your AIDA-PVA recognizes the channel and the request it will respond positively to the search request on your behalf,</li>
<li>Opening a direct communications channel to the client once the client accepts the response.</li>
<li>Now the AIDA-PVA will ask your <code>Channel Provider</code> to service the request and will return the results you give it.</li>
<li>By leveraging services in the AIDA-PVA module and legacy Channel Provider module in AIDASHR to access the Channel Data source, you can service those requests.</li>
</ol>
<p ><img src="usine-a-gaz-wa.png" alt="" class="inline" title="Usine a gaz with annotations"/></p>
<p >As an AIDA-PVA Service Provider writer you will be responsible for:</p>
<ul>
<li>Creating the AIDA-PVA <code>Channel Provider</code> Shared Library.</li>
<li>Creating the initial <code>CHANNELS.YML</code> file that identifies and describes all the AIDA-PVA <code>Channels</code> that your <code>Channel Provider</code> will support.</li>
</ul>
<h2><a class="anchor" id="autotoc_md13"></a>
Components</h2>
<ul>
<li>The <b>Provider Code</b> =&gt; produces <code>SLC&lt;provider_name&gt;.EXE</code> shared Library</li>
<li>The <b>AIDA-PVA</b> - <code>aida-pva.jar</code>, that loads the Provider Code</li>
<li>The <b>AIDA-PVA Module</b> - extensions to AIDASHR that provide helper functions for the Provider Code</li>
<li>The <b>back-ported EPICS 7</b> libraries<ul>
<li><code>epics-pvaccess.jar</code></li>
<li><code>epics-pvdata.jar</code></li>
</ul>
</li>
<li>The <b>EPICS forwarder</b> - <code>epics-forwarder.jar</code></li>
</ul>
<h1><a class="anchor" id="autotoc_md14"></a>
Topology</h1>
<p ><img src="aida-pva-system-components.png" alt="" class="inline" title="Aida-PVA Topology"/></p>
<h1><a class="anchor" id="autotoc_md15"></a>
Normative Types</h1>
<p >see <a class="el" href="md_docs__normative_types.html">Normative Types</a></p>
<h1><a class="anchor" id="autotoc_md16"></a>
Supported Data Types</h1>
<p >see <a class="el" href="md_docs__suported_types.html">Supported Data Types</a></p>
<h1><a class="anchor" id="autotoc_md17"></a>
Implementation</h1>
<h2><a class="anchor" id="autotoc_md18"></a>
Overview</h2>
<p >There are three things to write before you can compile, run, test and deploy your service. Here</p>
<ul>
<li>Write a <code>CHANNELS.YML</code> file</li>
<li>Create a <code>Channel Provider</code></li>
<li>Create some tests</li>
</ul>
<h2><a class="anchor" id="autotoc_md19"></a>
Creating an &lt;tt&gt;CHANNELS.YML&lt;/tt&gt; file</h2>
<p >Definition of the <code>Channels</code> supported by your <code>Channel Service Provider</code> is done in the <code>CHANNELS.YML</code> file. If you're unfamiliar with the the YAML format you can <a href="https://www.redhat.com/sysadmin/yaml-beginners">familiarise yourself with the syntax and format</a> before reading further.</p>
<p >Please read <a class="el" href="md_docs__channels.html">documentation on the CHANNELS.YML</a> file for information on how to create one. An example configuration file is shown below:</p>
<div class="fragment"><div class="line">!!edu.stanford.slac.aida.lib.model.AidaProvider</div>
<div class="line"># Sample Channel Provider</div>
<div class="line">id: 42</div>
<div class="line">name: Channel Provider</div>
<div class="line">description: Your Channel Provider</div>
<div class="line">getterConfig:</div>
<div class="line">  type: INTEGER</div>
<div class="line">setterConfig:</div>
<div class="line">  type: TABLE</div>
<div class="line">    fields:</div>
<div class="line">        - name: isActive</div>
<div class="line">          label: &quot;Device is active?&quot;</div>
<div class="line">          description: &quot;Device activity status.  Active if true&quot;</div>
<div class="line">          - name: mode</div>
<div class="line">            label: &quot;Device Mode Code&quot;</div>
<div class="line">            description: &quot;Device mode code&quot;</div>
<div class="line">channels:</div>
<div class="line">  - channel: AIDA:CHAN:*:INT</div>
<div class="line">  - channel: AIDA:CHAN:P01:BOOL</div>
<div class="line">    getterConfig:</div>
<div class="line">      type: BOOLEAN</div>
<div class="line">  - channel: AIDA:CHAN:???:FLT</div>
<div class="line">    getterConfig:</div>
<div class="line">      type: FLOAT</div>
<div class="line">  - channel: AIDA:CHAN:P01:STRA</div>
<div class="line">    getterConfig:</div>
<div class="line">      type: STRING_ARRAY</div>
<div class="line">  - channel: AIDA:CHAN:P01:TABL</div>
<div class="line">    getterConfig:</div>
<div class="line">      type: TABLE</div>
<div class="line">      fields:</div>
<div class="line">        - name: isActive</div>
<div class="line">          label: &quot;Device is active?&quot;</div>
<div class="line">          description: &quot;Device activity status.  Active if true&quot;</div>
<div class="line">        - name: mode</div>
<div class="line">          label: &quot;Device Mode Code&quot;</div>
<div class="line">          description: &quot;Device mode code&quot;</div>
<div class="line">  - channel: AIDA:CHAN:S01:VOID</div>
<div class="line">    setterConfig:</div>
<div class="line">      type: VOID</div>
<div class="line">  - channel: AIDA:CHAN:S01:DEFA</div>
<div class="line">  - channel: AIDA:CHAN:S01:TABL</div>
<div class="line">    setterConfig:</div>
<div class="line">      type: TABLE</div>
<div class="line">      fields:</div>
<div class="line">        - name: status</div>
<div class="line">          label: &quot;Result of setting value&quot;</div>
<div class="line">          description: &quot;True if the value was set successfully&quot;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md20"></a>
Creating a &lt;tt&gt;Channel Provider&lt;/tt&gt;</h2>
<p >Thanks to the <code>AIDA-PVA Module</code> creating a service provider is easy. There is only one file to write and here is the code template.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;aida_server_helper.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;json.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;slc_macros.h&quot;</span>           <span class="comment">/* vmsstat_t, int2u, int4u, etc. */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// API Stubs</span></div>
<div class="line">REQUEST_STUB_CHANNEL_CONFIG</div>
<div class="line">REQUEST_STUB_BOOLEAN</div>
<div class="line">REQUEST_STUB_BYTE</div>
<div class="line">REQUEST_STUB_SHORT</div>
<div class="line">REQUEST_STUB_INTEGER</div>
<div class="line">REQUEST_STUB_LONG</div>
<div class="line">REQUEST_STUB_FLOAT</div>
<div class="line">REQUEST_STUB_DOUBLE</div>
<div class="line">REQUEST_STUB_STRING</div>
<div class="line">REQUEST_STUB_BOOLEAN_ARRAY</div>
<div class="line">REQUEST_STUB_BYTE_ARRAY</div>
<div class="line">REQUEST_STUB_SHORT_ARRAY</div>
<div class="line">REQUEST_STUB_INTEGER_ARRAY</div>
<div class="line">REQUEST_STUB_LONG_ARRAY</div>
<div class="line">REQUEST_STUB_FLOAT_ARRAY</div>
<div class="line">REQUEST_STUB_DOUBLE_ARRAY</div>
<div class="line">REQUEST_STUB_STRING_ARRAY</div>
<div class="line">REQUEST_STUB_TABLE</div>
<div class="line">SET_STUB_VOID</div>
<div class="line">SET_STUB_TABLE</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * Initialise the service</span></div>
<div class="line"><span class="comment"> * @param env to be used to throw exceptions using aidaThrow() and aidaNonOsExceptionThrow()</span></div>
<div class="line"><span class="comment"> * @throws ServerInitialisationException if the service fails to initialise</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">void</span> aidaServiceInit(JNIEnv* env)</div>
<div class="line">{</div>
<div class="line">    DO_STANDALONE_INIT_NO_MSG(<span class="stringliteral">&quot;AIDA-PVA_SLCMYPROVIDER&quot;</span>, <span class="stringliteral">&quot;My Provider&quot;</span>,</div>
<div class="line">            <span class="keyword">true</span>,        <span class="comment">// db init</span></div>
<div class="line">            <span class="keyword">false</span>,       <span class="comment">// query init</span></div>
<div class="line">            <span class="keyword">false</span>)       <span class="comment">// set init</span></div>
<div class="line">}</div>
</div><!-- fragment --><p >For any of the types that your <code>Channel Provider</code> will support you need to remove the corresponding <em>STUB</em> line and replace it with the implementation. You'll find the prototypes below:</p>
<h3><a class="anchor" id="autotoc_md21"></a>
AIDA-PVA Module</h3>
<p >The <code>AIDA-PVA Module</code> is a module contained in the <code>AIDASHR</code> shared library that provides all the boilerplate functionality needed to respond to <code>get</code> and <code>set</code> requests, marshal and unmarshal objects, and simple types across the JNI boundary and between your <code>Channel Provider</code> and VMS and the Channel Provider module in <code>AIDASHR</code>.</p>
<h4><a class="anchor" id="autotoc_md22"></a>
Types</h4>
<p >These are defined in <code><a class="el" href="aida__types_8h_source.html">aida_types.h</a></code> but are automatically loaded by including <code><a class="el" href="aida__server__helper_8c_source.html">aida_server_helper.c</a></code>.</p>
<p ><a class="anchor" id="autotoc_md23"></a> </p><h5>Type</h5>
<p >This enumerated type will be used throughout your code to identify the data types you are manipulating.</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span></div>
<div class="line">{</div>
<div class="line">    AIDA_NO_TYPE,                        <span class="comment">// Used to indicate that no type was provided as an argument</span></div>
<div class="line">    AIDA_VOID_TYPE,                      <span class="comment">// Used when no return value is to be returned from a channel</span></div>
<div class="line"> </div>
<div class="line">    AIDA_BOOLEAN_TYPE,                   <span class="comment">// Represents a boolean</span></div>
<div class="line">    AIDA_BYTE_TYPE,                      <span class="comment">// Represents a byte</span></div>
<div class="line">    AIDA_SHORT_TYPE,                     <span class="comment">// Represents a short</span></div>
<div class="line">    AIDA_INTEGER_TYPE,                   <span class="comment">// Represents an integer</span></div>
<div class="line">    AIDA_LONG_TYPE,                      <span class="comment">// Represents a long</span></div>
<div class="line">    AIDA_FLOAT_TYPE,                     <span class="comment">// Represents a float</span></div>
<div class="line">    AIDA_DOUBLE_TYPE,                    <span class="comment">// Represents a double</span></div>
<div class="line">    AIDA_STRING_TYPE,                    <span class="comment">// Represents a string</span></div>
<div class="line">    AIDA_BOOLEAN_ARRAY_TYPE,             <span class="comment">// Represents a boolean array</span></div>
<div class="line">    AIDA_BYTE_ARRAY_TYPE,                <span class="comment">// Represents a byte array</span></div>
<div class="line">    AIDA_SHORT_ARRAY_TYPE,               <span class="comment">// Represents a short array</span></div>
<div class="line">    AIDA_INTEGER_ARRAY_TYPE,             <span class="comment">// Represents an integer array</span></div>
<div class="line">    AIDA_LONG_ARRAY_TYPE,                <span class="comment">// Represents a long array</span></div>
<div class="line">    AIDA_FLOAT_ARRAY_TYPE,               <span class="comment">// Represents a float array</span></div>
<div class="line">    AIDA_DOUBLE_ARRAY_TYPE,              <span class="comment">// Represents a double array</span></div>
<div class="line">    AIDA_STRING_ARRAY_TYPE,              <span class="comment">// Represents a string array</span></div>
<div class="line">    AIDA_TABLE_TYPE,                     <span class="comment">// Represents a table</span></div>
<div class="line">    AIDA_JSON_TYPE,                      <span class="comment">// Argument was provided as JSON text</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Internal use only: DO NOT USE IN SERVICE IMPLEMENTATIONS!!</span></div>
<div class="line">    AIDA_UNSIGNED_SHORT_TYPE,            <span class="comment">// Represents an internal type of unsigned short</span></div>
<div class="line">    AIDA_UNSIGNED_INTEGER_TYPE,          <span class="comment">// Represents an internal type of unsigned integer</span></div>
<div class="line">    AIDA_UNSIGNED_LONG_TYPE,             <span class="comment">// Represents an internal type of unsigned long</span></div>
<div class="line">    AIDA_UNSIGNED_SHORT_ARRAY_TYPE,      <span class="comment">// Represents an internal type of unsigned short array</span></div>
<div class="line">    AIDA_UNSIGNED_INTEGER_ARRAY_TYPE,    <span class="comment">// Represents an internal type of unsigned integer array</span></div>
<div class="line">    AIDA_UNSIGNED_LONG_ARRAY_TYPE        <span class="comment">// Represents an internal type of unsigned long array</span></div>
<div class="line">} Type;</div>
</div><!-- fragment --><h6><em>aidaChannelConfig</em> endpoint</h6>
<p >Normally you will never implement this endpoint but if you want to, you will need these three types:</p>
<ol type="1">
<li><code>Config</code></li>
<li><code>Layout</code></li>
<li><code>Field</code></li>
</ol>
<p ><em>Config</em> As you can see this type allows you to specify everything you need to configure either a getter or a setter for a channel.</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span></div>
<div class="line">{</div>
<div class="line">    Type type;</div>
<div class="line">    <span class="keywordtype">char</span>* description;</div>
<div class="line">    Layout layout;</div>
<div class="line">    <span class="keywordtype">int</span> fieldCount;</div>
<div class="line">    Field* fields;</div>
<div class="line">} Config;</div>
</div><!-- fragment --><p ><em>Layout</em></p>
<p >The <code>Layout</code> allows you to specify table orientation in the rare case you don't want the default <code>COLUMN_MAJOR</code> table orientation.</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span></div>
<div class="line">{</div>
<div class="line">    AIDA_NO_LAYOUT,</div>
<div class="line">    AIDA_COLUMN_MAJOR_LAYOUT,  <span class="comment">// Each top level array entry is a column containing row data</span></div>
<div class="line">    AIDA_ROW_MAJOR_LAYOUT      <span class="comment">// Each top level array entry is a row containing column data</span></div>
<div class="line">} Layout;</div>
</div><!-- fragment --><p ><em>Field</em></p>
<p >The <code>Field</code> allows you to specify any fields in any table you define.</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span></div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span>* name;</div>
<div class="line">    <span class="keywordtype">char</span>* label;</div>
<div class="line">    <span class="keywordtype">char</span>* description;</div>
<div class="line">    <span class="keywordtype">char</span>* units;</div>
<div class="line">} Field;</div>
</div><!-- fragment --><h6><a class="el" href="struct_arguments.html" title="An Arguments structure stores all of the arguments passed from the request to the Native Channel Prov...">Arguments</a> and Values</h6>
<p >When your endpoints are called, the framework passes them <a class="el" href="struct_arguments.html" title="An Arguments structure stores all of the arguments passed from the request to the Native Channel Prov...">Arguments</a> and Values. The following types are defined for you. The helper functions presented later make knowledge of these details irrelevant but here they are for your edification.</p>
<p ><em><a class="el" href="struct_arguments.html" title="An Arguments structure stores all of the arguments passed from the request to the Native Channel Prov...">Arguments</a></em></p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span></div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> argumentCount;</div>
<div class="line">    <a class="code hl_struct" href="struct_argument.html">Argument</a>* arguments;</div>
<div class="line">} <a class="code hl_struct" href="struct_arguments.html">Arguments</a>;</div>
<div class="ttc" id="astruct_argument_html"><div class="ttname"><a href="struct_argument.html">Argument</a></div><div class="ttdoc">A single request argument.</div><div class="ttdef"><b>Definition:</b> <a href="aida__types_8h_source.html#l00117">aida_types.h:118</a></div></div>
<div class="ttc" id="astruct_arguments_html"><div class="ttname"><a href="struct_arguments.html">Arguments</a></div><div class="ttdoc">An Arguments structure stores all of the arguments passed from the request to the Native Channel Prov...</div><div class="ttdef"><b>Definition:</b> <a href="aida__types_8h_source.html#l00155">aida_types.h:156</a></div></div>
</div><!-- fragment --><p ><em><a class="el" href="struct_argument.html" title="A single request argument.">Argument</a></em></p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span></div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span>* name;</div>
<div class="line">    <span class="keywordtype">char</span>* value;</div>
<div class="line">} <a class="code hl_struct" href="struct_argument.html">Argument</a>;</div>
</div><!-- fragment --><p ><em><a class="el" href="struct_value.html" title="This special type represents a Value.">Value</a></em> This is passed to you when one of the arguments name is <code>VALUE</code>. It will contain the value as specified in the argument field but also a pre-parsed json structure if the argument value was properly formatted json.</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span></div>
<div class="line">{</div>
<div class="line">    Type type;    <span class="comment">// AIDA_STRING_TYPE or AIDA_JSON_TYPE</span></div>
<div class="line">    <a class="code hl_union" href="union_value_contents.html">ValueContents</a> value;</div>
<div class="line">} <a class="code hl_struct" href="struct_value.html">Value</a>;</div>
<div class="ttc" id="astruct_value_html"><div class="ttname"><a href="struct_value.html">Value</a></div><div class="ttdoc">This special type represents a Value.</div><div class="ttdef"><b>Definition:</b> <a href="aida__types_8h_source.html#l00140">aida_types.h:141</a></div></div>
<div class="ttc" id="aunion_value_contents_html"><div class="ttname"><a href="union_value_contents.html">ValueContents</a></div><div class="ttdoc">This union stores either the string or the json_value of a Value.</div><div class="ttdef"><b>Definition:</b> <a href="aida__types_8h_source.html#l00129">aida_types.h:130</a></div></div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">union</span></div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span>* stringValue;</div>
<div class="line">    <a class="code hl_struct" href="struct__json__value.html">json_value</a>* jsonValue;</div>
<div class="line">} <a class="code hl_union" href="union_value_contents.html">ValueContents</a>;</div>
<div class="ttc" id="astruct__json__value_html"><div class="ttname"><a href="struct__json__value.html">_json_value</a></div><div class="ttdef"><b>Definition:</b> <a href="json_8h_source.html#l00102">json.h:103</a></div></div>
</div><!-- fragment --><h6><a class="el" href="struct_table.html" title="Table structure.">Table</a></h6>
<p >This structure is used when processing requests that require tables.</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span></div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> columnCount;</div>
<div class="line">    <span class="keywordtype">int</span> rowCount;</div>
<div class="line">    Type* types;</div>
<div class="line">    <span class="keywordtype">void</span>** ppData;</div>
<div class="line">    <span class="keywordtype">int</span> _currentColumn; <span class="comment">// For internal use by addColumn() etc</span></div>
<div class="line">} <a class="code hl_struct" href="struct_table.html">Table</a>;</div>
<div class="ttc" id="astruct_table_html"><div class="ttname"><a href="struct_table.html">Table</a></div><div class="ttdoc">Table structure.</div><div class="ttdef"><b>Definition:</b> <a href="aida__types_8h_source.html#l00186">aida_types.h:187</a></div></div>
</div><!-- fragment --><h6>Arrays</h6>
<p >To process data in any scalar array endpoint you need to use the following structures. As with other data types you won't need to manipulate them directly as helper functions obviate the need.</p>
<p ><em><a class="el" href="struct_array.html" title="An array of data.">Array</a></em></p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span></div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> count;</div>
<div class="line">    <span class="keywordtype">void</span>* items;</div>
<div class="line">} <a class="code hl_struct" href="struct_array.html">Array</a>;</div>
<div class="ttc" id="astruct_array_html"><div class="ttname"><a href="struct_array.html">Array</a></div><div class="ttdoc">An array of data.</div><div class="ttdef"><b>Definition:</b> <a href="aida__types_8h_source.html#l00204">aida_types.h:205</a></div></div>
</div><!-- fragment --><p ><em><a class="el" href="struct_string_array.html" title="An array of string data.">StringArray</a></em></p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span></div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> count;</div>
<div class="line">    <span class="keywordtype">char</span>** items;</div>
<div class="line">} <a class="code hl_struct" href="struct_string_array.html">StringArray</a>;</div>
<div class="ttc" id="astruct_string_array_html"><div class="ttname"><a href="struct_string_array.html">StringArray</a></div><div class="ttdoc">An array of string data.</div><div class="ttdef"><b>Definition:</b> <a href="aida__types_8h_source.html#l00222">aida_types.h:223</a></div></div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md24"></a>
Macros</h4>
<p >This section describes the macros that are defined to make your life easier.</p>
<p ><a class="anchor" id="autotoc_md25"></a> </p><h5>General</h5>
<p ><a class="anchor" id="autotoc_md26"></a> </p><h5>Exceptions</h5>
<p ><a class="anchor" id="autotoc_md27"></a> </p><h5>Data Conversion</h5>
<p ><a class="anchor" id="autotoc_md28"></a> </p><h5>Memory Management</h5>
<h4><a class="anchor" id="autotoc_md29"></a>
Helper Functions</h4>
<h4><a class="anchor" id="autotoc_md30"></a>
Argument processing</h4>
<p ><a class="anchor" id="autotoc_md31"></a> </p><h5>ascanf, avscanf</h5>
<p >Synopsis</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> ascanf(JNIEnv* env, <a class="code hl_struct" href="struct_arguments.html">Arguments</a>* arguments, <span class="keyword">const</span> <span class="keywordtype">char</span>* formatString, ...);</div>
<div class="line"><span class="keywordtype">int</span> avscanf(JNIEnv* env, <a class="code hl_struct" href="struct_arguments.html">Arguments</a>* arguments, <a class="code hl_struct" href="struct_value.html">Value</a>* value, <span class="keyword">const</span> <span class="keywordtype">char</span>* formatString, ...);</div>
</div><!-- fragment --><p >Details</p>
<p >Reads data from the given arguments and stores them according to parameter format into the locations given by the additional arguments, as if <code>scanf</code> was used, but reading from arguments instead of the standard input (stdin).</p>
<p >The additional arguments should point to already allocated objects of the type specified by their corresponding format specifier. For strings and arrays only the pointer needs to be pre-allocated - not the data that the pointer will reference.</p>
<p >The only space allocated by this function is for strings, and arrays. You need to free those when you're done.</p>
<p >In this example, only the provided pointer needs to be freed as only one allocation is made:</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="struct_arguments.html">Arguments</a> arguments;</div>
<div class="line"><span class="keywordtype">float</span> theFloat;</div>
<div class="line"><span class="keywordtype">int</span> *intArray;</div>
<div class="line">ascanf(arguments <span class="stringliteral">&quot;$of, %da&quot;</span>, <span class="stringliteral">&quot;f&quot;</span>, &amp;theFloat, <span class="stringliteral">&quot;fooArray&quot;</span>, &amp;intArray);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Do stuff</span></div>
<div class="line">free(intArray);</div>
</div><!-- fragment --><p >There are a number of other differences from scanf which are best described by example:</p>
<p ><em>Scan into simple variable</em></p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> n;</div>
<div class="line">ascanf(<span class="stringliteral">&quot;%d&quot;</span>, <span class="stringliteral">&quot;NPOS&quot;</span>, &amp;n);</div>
</div><!-- fragment --><p >You must always provide the name of the variable and the pointer to the place to put the value in pairs</p>
<p ><em>Optional arguments</em> Optional arguments are specified with the o character before the format character.</p>
<div class="fragment"><div class="line"><span class="keywordtype">short</span> flag = 10;  <span class="comment">// 10 is the default value</span></div>
<div class="line">ascanf(<span class="stringliteral">&quot;%ohd&quot;</span>, <span class="stringliteral">&quot;flag&quot;</span>, &amp;flag);</div>
</div><!-- fragment --><p >By default all arguments are considered required unless this character is specified. For optional arguments the pointer provided must point to the default value. In the case of arrays and strings this will be copied into allocated storage that will need to be freed as normal. i.e. strings themselves don't need to be freed.</p>
<p ><em>Variable Names</em></p>
<ol type="1">
<li><p class="startli">You can specify simple variable names</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> simpleInt;</div>
<div class="line">ascanf(&amp;arguments <span class="stringliteral">&quot;%d, &quot;</span>simple<span class="stringliteral">&quot;, &amp;simpleInt);</span></div>
</div><!-- fragment --></li>
<li>You can specify simple names or you can use dot and square brace notation to refer to arguments that refer to json structures. e.g. given a variable named json and presented as</li>
</ol>
<div class="fragment"><div class="line">json=<span class="stringliteral">&#39; { &quot;foo&quot;: {&quot;bar&quot;: 0} }}&#39;</span></div>
</div><!-- fragment --><p >You can specify the name as <code>json.foo.bar</code> to retrieve the <code>0</code> value *</p>
<ol type="1">
<li>Also given a variable named jsonArray and presented as</li>
</ol>
<div class="fragment"><div class="line">jsonArray=<span class="stringliteral">&#39; [ {&quot;foo&quot;: 10}, {&quot;bar&quot;: 20} ]&#39;</span></div>
</div><!-- fragment --><p >You can specify the name as <code>jsonArray[1].bar</code> to retrieve the <code>20</code> value</p>
<ol type="1">
<li>Finally, if you use the variable name <code>value</code> in the call, the <code>avscanf()</code> function will use the supplied <code>value</code> to get the data for that parameter</li>
</ol>
<div class="fragment"><div class="line"><a class="code hl_struct" href="struct_arguments.html">Arguments</a> arguments;</div>
<div class="line"><a class="code hl_struct" href="struct_value.html">Value</a> value;</div>
<div class="line"><span class="keywordtype">int</span> *intArray;</div>
<div class="line">avscanf(&amp;arguments &amp;value, <span class="stringliteral">&quot;%da&quot;</span>, fooArray<span class="stringliteral">&quot;, &amp;intArray);</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">// Do stuff</span></div>
<div class="line"><span class="stringliteral">free(intArray);</span></div>
</div><!-- fragment --><p >Format Specifiers</p>
<p ><em>Supported formats specifiers</em></p>
<ul>
<li><code>d</code> : <code>int *</code> - extract an integer into the corresponding variable (see <code>l</code> &amp; <code>h</code> below).</li>
<li><code>u</code> : <code>unsigned int *</code> - extract an unsigned integer into the corresponding variable (see <code>l</code> &amp; <code>h</code> below)</li>
<li><code>f</code> : <code>float *` - extract a floating point number (see `l` below)</code></li>
<li><code>`s` :</code>char *<code>- extract a string of characters into allocated space and point the corresponding variable to it -</code>c<code>:</code><code>char *</code> - extract a single character into the corresponding variable</li>
</ul>
<p ><em>Required flag</em></p>
<ul>
<li><code>o</code> - optional precede the format with <code>o</code> to indicate that the argument is optional</li>
</ul>
<p ><em>Prefixes</em></p>
<ul>
<li><code>h</code> - <code>short *</code> - preceding <code>d</code> will retrieve a short e.g. <code>hd</code></li>
<li><code>l</code> - <code>long *</code>, double * - preceding d will retrieve a long e.g. <code>ld</code>, preceding <code>f</code> will retrieve a double e.g. <code>lf</code></li>
</ul>
<p ><em>Suffixes</em></p>
<ul>
<li><code>a</code> - extract an array of the preceding type into a block of allocated space and point the corresponding variable to it. the variable will have an extra level of indirection than the non-array version e.g. <code>d</code>, <code>int *</code> becomes <code>da</code> , <code>int **</code></li>
</ul>
<p >Parameters:</p>
<ul>
<li><code>env</code> - just pass in the <code>env</code> parameter that your endpoint was given by the framework</li>
<li><code>arguments</code> - arguments that the function processes as its source to retrieve the data.</li>
<li><code>value</code> value that the function processes as its source to retrieve the data</li>
<li><code>formatString</code> C string that contains a format string as described above</li>
<li><code>...</code> Depending on the format string, the function may expect a sequence of additional arguments, containing pairs of names and pointers to allocated storage (except as indicated above), where the interpretation of the extracted data is stored with the appropriate type. There should be at least as many pairs of these arguments as the number of values stored by the format specifiers. Additional arguments are ignored by the function <dl class="section return"><dt>Returns</dt><dd>true if all required arguments were read and no errors occurred </dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">MissingRequiredArgument</td><td>if one of the required arguments are missing</td></tr>
  </table>
  </dd>
</dl>
<a class="anchor" id="autotoc_md32"></a> <h5><a class="el" href="struct_table.html" title="Table structure.">Table</a> Manipulation</h5>
</li>
</ul>
<p >If order to return a table you need to do the following.</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="struct_table.html">Table</a> table = tableCreate(env, 1, 8);</div>
<div class="line">CHECK_EXCEPTION(table)</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Call one or more of the tableAdd functions to add data to the table</span></div>
<div class="line">tableAddSingleRowBooleanColumn(env, &amp;table, 1);</div>
<div class="line">CHECK_EXCEPTION(table)</div>
<div class="line">tableAddSingleRowStringColumn(env, &amp;table, <span class="stringliteral">&quot;eight&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Return the table</span></div>
<div class="line"><span class="keywordflow">return</span> table;</div>
</div><!-- fragment --><p >These are the list of table manipuation functions:</p>
<div class="fragment"><div class="line"><span class="comment">// Create a table and set the number of rows and columns</span></div>
<div class="line"><a class="code hl_struct" href="struct_table.html">Table</a> tableCreate(JNIEnv* env, <span class="keywordtype">int</span> rows, <span class="keywordtype">int</span> columns);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Add a column of arbitrary type (except string) to the table</span></div>
<div class="line"><span class="keywordtype">void</span> tableAddColumn(JNIEnv* env, <a class="code hl_struct" href="struct_table.html">Table</a>* table, Type type, <span class="keywordtype">void</span>* data, <span class="keywordtype">bool</span> ieeeFormat);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Add a string column of arbitrary length to the table</span></div>
<div class="line"><span class="keywordtype">void</span> tableAddStringColumn(JNIEnv* env, <a class="code hl_struct" href="struct_table.html">Table</a>* table, <span class="keywordtype">char</span>** data);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Add a single row of float data to the table</span></div>
<div class="line"><span class="keywordtype">void</span> tableAddSingleRowFloatColumn(JNIEnv* env, <a class="code hl_struct" href="struct_table.html">Table</a>* table, <span class="keywordtype">float</span> data, <span class="keywordtype">bool</span> ieeeFloat);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Add a single row of long data to the table</span></div>
<div class="line"><span class="keywordtype">void</span> tableAddSingleRowLongColumn(JNIEnv* env, <a class="code hl_struct" href="struct_table.html">Table</a>* table, <span class="keywordtype">long</span> data);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Add a single row of boolean data to the table</span></div>
<div class="line"><span class="keywordtype">void</span> tableAddSingleRowBooleanColumn(JNIEnv* env, <a class="code hl_struct" href="struct_table.html">Table</a>* table, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> data);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Adda a single row of byte data to the table</span></div>
<div class="line"><span class="keywordtype">void</span> tableAddSingleRowByteColumn(JNIEnv* env, <a class="code hl_struct" href="struct_table.html">Table</a>* table, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> data);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Add a single row of short data to the table</span></div>
<div class="line"><span class="keywordtype">void</span> tableAddSingleRowShortColumn(JNIEnv* env, <a class="code hl_struct" href="struct_table.html">Table</a>* table, <span class="keywordtype">short</span> data);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Add a single row of int data to the table</span></div>
<div class="line"><span class="keywordtype">void</span> tableAddSingleRowIntegerColumn(JNIEnv* env, <a class="code hl_struct" href="struct_table.html">Table</a>* table, <span class="keywordtype">int</span> data);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Add a single row of double data to the table</span></div>
<div class="line"><span class="keywordtype">void</span> tableAddSingleRowDoubleColumn(JNIEnv* env, <a class="code hl_struct" href="struct_table.html">Table</a>* table, <span class="keywordtype">double</span> data, <span class="keywordtype">bool</span> ieeeDouble);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Add a single row of string data to the table</span></div>
<div class="line"><span class="keywordtype">void</span> tableAddSingleRowStringColumn(JNIEnv* env, <a class="code hl_struct" href="struct_table.html">Table</a>* table, <span class="keywordtype">char</span>* data);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Add a single row of fixed width string data to the table</span></div>
<div class="line"><span class="keywordtype">void</span> tableAddFixedWidthStringColumn(JNIEnv* env, <a class="code hl_struct" href="struct_table.html">Table</a>* table, <span class="keywordtype">void</span>* data, <span class="keywordtype">int</span> width);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md33"></a>
Building your Shared Service</h2>
<h2><a class="anchor" id="autotoc_md34"></a>
Writing and running tests</h2>
<h2><a class="anchor" id="autotoc_md35"></a>
Deploying a Service Provider</h2>
<p >To implement a service (<code>yourService</code>) simply duplicate the <code>Reference</code> directories under <code>src/cpp/build</code> , <code>src/cpp/impl</code> and <code>src/cpp/include</code> and implement your code as appropriate to your service.</p>
<p >You will also need to provide a yaml file (<code>channels.yaml</code>) containing the channel definition which you'll place in you new <code>src/cpp/build{yourService}</code> directory.</p>
<p >From the <code>src/cpp/build{yourService}</code> directory, compile up the service using the <code>build</code> script which will deploy the library (<code>AIDA.EXE</code>) in the <code>lib/{yourService}</code> directory and copy the <code>channels.yml</code> file to the appropriate location.</p>
<div class="fragment"><div class="line">MCCDEV&gt; src</div>
<div class="line">Default:= DATA_DISK_SLC:[SCRATCH.SLY.DEV.AIDA-PVA.SRC]</div>
<div class="line">MCCDEV&gt; cd [.build.reference]</div>
<div class="line">MCCDEV&gt; @build</div>
<div class="line">DATA_DISK_SLC:[SCRATCH.SLY.DEV.AIDA-PVA.SRC.BUILD.REFERENCE]AIDA_JNI_HELPER.OBJ;7</div>
<div class="line">DATA_DISK_SLC:[SCRATCH.SLY.DEV.AIDA-PVA.SRC.BUILD.REFERENCE]AIDA_SERVER_HELPER.OBJ;7</div>
<div class="line">DATA_DISK_SLC:[SCRATCH.SLY.DEV.AIDA-PVA.SRC.BUILD.REFERENCE]AIDA_TYPES_HELPER.OBJ;7</div>
<div class="line">DATA_DISK_SLC:[SCRATCH.SLY.DEV.AIDA-PVA.SRC.BUILD.REFERENCE]NATIVECHANNELPROVIDERJNI.OBJ;7</div>
<div class="line">DATA_DISK_SLC:[SCRATCH.SLY.DEV.AIDA-PVA.SRC.BUILD.REFERENCE]REFERENCE_SERVER.OBJ;7</div>
</div><!-- fragment --><p >From the <code>lib/{yourlibrary}</code> directory start the service with <code>java -jar "-Djava.library.path=./" ../aida-pva.jar</code> where {yourLibrary} is the name of the library. ` e.g.</p>
<div class="fragment"><div class="line">MCCDEV&gt; lib</div>
<div class="line">Default:= DATA_DISK_SLC:[SCRATCH.SLY.DEV.AIDA-PVA.LIB]</div>
<div class="line">MCCDEV&gt; cd [.reference]</div>
<div class="line">MCCDEV&gt; java -jar &quot;-Djava.library.path=./&quot; ../aida-pva.jar</div>
<div class="line">Aida Service Initialised</div>
<div class="line"> </div>
<div class="line">       db         88  88888888ba,           db</div>
<div class="line">      d88b        88  88      `&quot;8b         d88b</div>
<div class="line">     d8&#39;`8b       88  88        `8b       d8&#39;`8b</div>
<div class="line">    d8&#39;  `8b      88  88         88      d8&#39;  `8b                8b,dPPYba,   8b       d8  ,adPPYYba,</div>
<div class="line">   d8YaaaaY8b     88  88         88     d8YaaaaY8b     aaaaaaaa  88P&#39;    &quot;8a  `8b     d8&#39;  &quot;&quot;     `Y8</div>
<div class="line">  d8&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;8b    88  88         8P    d8&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;8b    &quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;  88       d8   `8b   d8&#39;   ,adPPPPP88</div>
<div class="line"> d8&#39;        `8b   88  88      .a8P    d8&#39;        `8b             88b,   ,a8&quot;    `8b,d8&#39;    88,    ,88</div>
<div class="line">d8&#39;          `8b  88  88888888Y&quot;&#39;    d8&#39;          `8b            88`YbbdP&quot;&#39;       &quot;8&quot;      `&quot;8bbdP&quot;Y8</div>
<div class="line">                                                                 88</div>
<div class="line">                                                                 88</div>
<div class="line">AIDA-pva Channel Provider : Sample</div>
<div class="line">Channels hosted:</div>
<div class="line">  [AIDA:SAMPLE:DEVICE01:attribute04, AIDA:SAMPLE:DEVICE01//attribute14, AIDA:SAMPLE:DEVICE01:attribute15, AIDA:SAMPLE:DEVICE01//attribute03</div>
<div class="line">, AIDA:SAMPLE:DEVICE01:attribute18, AIDA:SAMPLE:DEVICE01:attribute20, AIDA:SAMPLE:DEVICE01:attribute02, AIDA:SAMPLE:DEVICE01//attribute18,</div>
<div class="line">AIDA:SAMPLE:DEVICE01//attribute06, ...]</div>
</div><!-- fragment --><p >Note that this assumes the library (EXE) is deployed in the current working directory and that the aida-pva jar is also deployed there.</p>
<h2><a class="anchor" id="autotoc_md36"></a>
Deployment</h2>
<p >Deployment is very simple.</p>
<ul>
<li>aida-pva.jar</li>
<li>service</li>
<li>epics forwarder</li>
</ul>
<h3><a class="anchor" id="autotoc_md37"></a>
AIDA-PVA library</h3>
<p >A shaded jar has been created (aida-pva) to implement AIDA-PVA. This jar contains all the EPICS and other libraries that are required, and it is also runnable. The only thing that you need to make sure is that your native service library is available on the java library path (specified with <code>-Djava.library.path=&lt;path_where_service_library_resides&gt;</code> on the commandline). You also need to make sure that a <code>channels.yaml</code> file, is found in the working directory of the service.</p>
<h3><a class="anchor" id="autotoc_md38"></a>
Service</h3>
<h3><a class="anchor" id="autotoc_md39"></a>
EPICS Forwarder</h3>
<p >This component will be required for EPICS on Open-VMS to workaround an issue related to multi-cast sockets in Java 1.5. It simply listens for any EPICS requests and forwards them to any listening AIDA-PVA services.</p>
<h2><a class="anchor" id="autotoc_md40"></a>
Framework</h2>
<p ><img src="docs/aida-pva.png" alt="Aida-PVA Topology" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md41"></a>
Running</h1>
<p >To run AIDA-PVA and tests you'll need to start the service and also use some tool to test it</p>
<h2><a class="anchor" id="autotoc_md42"></a>
Required Service Files</h2>
<ul>
<li><code>aida-pva.jar</code> - anywhere in the java classpath</li>
<li><code>channels.yml</code> - in current working directory where you start service</li>
<li><code>AIDA-PVA.EXE</code> - anywhere in the java load library path</li>
</ul>
<h2><a class="anchor" id="autotoc_md43"></a>
Start the forwarder once</h2>
<p >On any site (networking terminology for a host) one EPICS Forwarder must be running. <br  />
 It must be started before any AIDA-PVA services are started on that site. One, and only one, must be running.</p>
<p >To start the EPICS forwarded:</p>
<div class="fragment"><div class="line">MCCDEV&gt; java -jar epics-forwarder.jar</div>
<div class="line">Jun 30, 2021 9:16:27 AM org.epics.forwarder.PVAForwarder main</div>
<div class="line">INFO: EPICS Request Forwarder started: 1824 milliseconds</div>
<div class="line">16:16 &gt; .....</div>
</div><!-- fragment --><p >Note: You will see a '.' show for each request that is forwarded by the EPICS Forwarder, and a new line will start for each hour that there is at least one request. You can use this display to get an idea of the request rates.</p>
<h2><a class="anchor" id="autotoc_md44"></a>
Start the service</h2>
<p >You can start the service by executing the following command.</p>
<div class="fragment"><div class="line">MCCDEV&gt; java -jar &quot;-Djava.library.path=.&quot; aida-pva.jar</div>
</div><!-- fragment --><p >The foregoing assumes that all required files are in the current working directory</p>
<h2><a class="anchor" id="autotoc_md45"></a>
Reference Service</h2>
<p >AIDA-PVA provides a reference service implementation. You can use this to verify your configuration before deploying your service. The reference implementation provides the following channels:</p>
<ul>
<li><code>AIDA:SAMPLE:DEVICE01:attribute01</code> - simple boolean</li>
<li><code>AIDA:SAMPLE:DEVICE01:attribute02</code> - simple byte</li>
<li><code>AIDA:SAMPLE:DEVICE01:attribute03</code> - simple short</li>
<li><code>AIDA:SAMPLE:DEVICE01:attribute04</code> - simple integer</li>
<li><code>AIDA:SAMPLE:DEVICE01:attribute05</code> - simple long</li>
<li><code>AIDA:SAMPLE:DEVICE01:attribute06</code> - simple float</li>
<li><code>AIDA:SAMPLE:DEVICE01:attribute07</code> - simple double</li>
<li><code>AIDA:SAMPLE:DEVICE01:attribute08</code> - simple string</li>
<li><code>AIDA:SAMPLE:DEVICE01:attribute11</code> - array of booleans</li>
<li><code>AIDA:SAMPLE:DEVICE01:attribute12</code> - array of bytes</li>
<li><code>AIDA:SAMPLE:DEVICE01:attribute13</code> - array of shorts</li>
<li><code>AIDA:SAMPLE:DEVICE01:attribute14</code> - array of integers</li>
<li><code>AIDA:SAMPLE:DEVICE01:attribute15</code> - array of longs</li>
<li><code>AIDA:SAMPLE:DEVICE01:attribute16</code> - array of floats</li>
<li><code>AIDA:SAMPLE:DEVICE01:attribute17</code> - array of doubles</li>
<li><code>AIDA:SAMPLE:DEVICE01:attribute18</code> - array of strings</li>
<li><code>AIDA:SAMPLE:DEVICE01:attribute20</code> - NT-TABLE : table normative-type</li>
</ul>
<p >Each simple scalar channel additionally takes an optional parameter to showcase how parameters are parsed and used.</p>
<h2><a class="anchor" id="autotoc_md46"></a>
Testing your service</h2>
<p >To test the service you can use some of the EPICS utils already deployed in SLAC.</p>
<h3><a class="anchor" id="autotoc_md47"></a>
Using pvcall</h3>
<p >From a different host ...</p>
<div class="fragment"><div class="line">bash-4.1$ source /afs/slac/g/lcls/epics/setup/epicsenv-7.0.2-1.1.bash</div>
<div class="line">bash-4.1$ export EPICS_PVA_ADDR_LIST=mccdev.slac.stanford.edu</div>
<div class="line">bash-4.1$ pvcall &#39;AIDA:SAMPLE:DEVICE01:attribute01&#39;</div>
<div class="line">true</div>
<div class="line">bash-4.1$ pvcall &#39;AIDA:SAMPLE:DEVICE01:attribute02&#39;</div>
<div class="line">2</div>
<div class="line">bash-4.1$ pvcall &#39;AIDA:SAMPLE:DEVICE01:attribute03&#39;</div>
<div class="line">3</div>
<div class="line">bash-4.1$ pvcall &#39;AIDA:SAMPLE:DEVICE01:attribute04&#39;</div>
<div class="line">4</div>
<div class="line">bash-4.1$ pvcall &#39;AIDA:SAMPLE:DEVICE01:attribute05&#39;</div>
<div class="line">5</div>
<div class="line">bash-4.1$ pvcall &#39;AIDA:SAMPLE:DEVICE01:attribute06&#39;</div>
<div class="line">6.6</div>
<div class="line">bash-4.1$ pvcall &#39;AIDA:SAMPLE:DEVICE01:attribute07&#39;</div>
<div class="line">7.7</div>
<div class="line">bash-4.1$ pvcall &#39;AIDA:SAMPLE:DEVICE01:attribute08&#39;</div>
<div class="line">eight</div>
<div class="line">bash-4.1$ pvcall &#39;AIDA:SAMPLE:DEVICE01:attribute10&#39;</div>
<div class="line">Timeout</div>
<div class="line">bash-4.1$ pvcall &#39;AIDA:SAMPLE:DEVICE01:attribute11&#39;</div>
<div class="line">[true]</div>
<div class="line">bash-4.1$ pvcall &#39;AIDA:SAMPLE:DEVICE01:attribute12&#39;</div>
<div class="line">[12]</div>
<div class="line">bash-4.1$ pvcall &#39;AIDA:SAMPLE:DEVICE01:attribute13&#39;</div>
<div class="line">[13]</div>
<div class="line">bash-4.1$ pvcall &#39;AIDA:SAMPLE:DEVICE01:attribute14&#39;</div>
<div class="line">[14]</div>
<div class="line">bash-4.1$ pvcall &#39;AIDA:SAMPLE:DEVICE01:attribute15&#39;</div>
<div class="line">[15]</div>
<div class="line">bash-4.1$ pvcall &#39;AIDA:SAMPLE:DEVICE01:attribute16&#39;</div>
<div class="line">[16.6]</div>
<div class="line">bash-4.1$ pvcall &#39;AIDA:SAMPLE:DEVICE01:attribute17&#39;</div>
<div class="line">[17.7]</div>
<div class="line">bash-4.1$ pvcall &#39;AIDA:SAMPLE:DEVICE01:attribute18&#39;</div>
<div class="line">[&quot;eighteen&quot;]</div>
<div class="line">bash-4.1$ pvcall &#39;AIDA:SAMPLE:DEVICE01:attribute20&#39;</div>
<div class="line"> </div>
<div class="line">isActive mode status nbufs memory sensor hisensor message</div>
<div class="line">    true    2      3     4      5    6.6      7.7   eight</div>
<div class="line">bash-4.1$</div>
</div><!-- fragment --><p >An example of using parameters follows. Note that for all the scalar types in the reference implementation an optional argument <code>x</code> is available. If present it will have the following effects on the results.</p>
<ul>
<li><code>AIDA:SAMPLE:DEVICE01:attribute01</code> - simple boolean. <code>x</code> will be combined by logical <code>AND</code> with default value</li>
<li><code>AIDA:SAMPLE:DEVICE01:attribute02</code> - simple byte. <code>x</code> will be combined by bitwise-or <code>|</code> with default value</li>
<li><code>AIDA:SAMPLE:DEVICE01:attribute03</code> - simple short. <code>x</code> will be combined by sum <code>+</code> with default value</li>
<li><code>AIDA:SAMPLE:DEVICE01:attribute04</code> - simple integer. <code>x</code> will be combined by sum <code>+</code> with default value</li>
<li><code>AIDA:SAMPLE:DEVICE01:attribute05</code> - simple long. <code>x</code> will be combined by sum <code>+</code> with default value</li>
<li><code>AIDA:SAMPLE:DEVICE01:attribute06</code> - simple float. <code>x</code> will be combined by multiplication <code>*</code> with default value</li>
<li><code>AIDA:SAMPLE:DEVICE01:attribute07</code> - simple double. <code>x</code> will be combined by multiplication <code>*</code> with default value</li>
<li><code>AIDA:SAMPLE:DEVICE01:attribute08</code> - simple string. <code>x</code> will be combined by concatenation with default value</li>
</ul>
<div class="fragment"><div class="line">bash-4.1$ source /afs/slac/g/lcls/epics/setup/epicsenv-7.0.2-1.1.bash</div>
<div class="line">bash-4.1$ export EPICS_PVA_ADDR_LIST=mccdev.slac.stanford.edu</div>
<div class="line">bash-4.1$ pvcall &#39;AIDA:SAMPLE:DEVICE01:attribute01&#39; x=true</div>
<div class="line">true</div>
<div class="line">bash-4.1$ pvcall &#39;AIDA:SAMPLE:DEVICE01:attribute01&#39; x=false</div>
<div class="line">false</div>
<div class="line">bash-4.1$ pvcall &#39;AIDA:SAMPLE:DEVICE01:attribute01&#39; x=1</div>
<div class="line">true</div>
<div class="line">bash-4.1$ pvcall &#39;AIDA:SAMPLE:DEVICE01:attribute02&#39; x=0x0f</div>
<div class="line">2</div>
<div class="line">bash-4.1$ pvcall &#39;AIDA:SAMPLE:DEVICE01:attribute02&#39; x=0x00</div>
<div class="line">0</div>
<div class="line">bash-4.1$ pvcall &#39;AIDA:SAMPLE:DEVICE01:attribute02&#39; x=6</div>
<div class="line">2</div>
<div class="line">bash-4.1$ pvcall &#39;AIDA:SAMPLE:DEVICE01:attribute03&#39; x=3</div>
<div class="line">6</div>
<div class="line">bash-4.1$ pvcall &#39;AIDA:SAMPLE:DEVICE01:attribute04&#39; x=4</div>
<div class="line">8</div>
<div class="line">bash-4.1$ pvcall &#39;AIDA:SAMPLE:DEVICE01:attribute05&#39; x=5</div>
<div class="line">10</div>
<div class="line">bash-4.1$ pvcall &#39;AIDA:SAMPLE:DEVICE01:attribute06&#39; x=2</div>
<div class="line">13.2</div>
<div class="line">bash-4.1$ pvcall &#39;AIDA:SAMPLE:DEVICE01:attribute07&#39; x=0.5</div>
<div class="line">3.85</div>
<div class="line">bash-4.1$ pvcall &#39;AIDA:SAMPLE:DEVICE01:attribute08&#39; x=Value</div>
<div class="line">Value: eight</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2
</small></address>
</body>
</html>
